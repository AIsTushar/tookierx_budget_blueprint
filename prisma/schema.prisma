generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

model User {
  id                 String     @id @default(auto()) @map("_id") @db.ObjectId
  subscriptionUserId String?    @db.ObjectId
  email              String     @unique
  name               String?
  role               Role       @default(USER)
  status             Status     @default(PENDING)
  password           String
  fcmToken           String?
  latitude           Float?
  longitude          Float?
  location           String?
  frequency          Frequency?
  customerId         String?
  isVerified         Boolean    @default(false)
  createdAt          DateTime   @default(now())
  updatedAt          DateTime   @updatedAt

  receiver           Notifications[]     @relation("receiverDetails")
  sender             Notifications[]     @relation("senderDetails")
  subscriptionUser   SubscriptionUser?
  paychecks          Paycheck[]
  allowanceTrackers  AllowanceTracker[]
  savingsTrackers    SavingsTracker[]
  creditCardTrackers CreditCardTracker[]

  @@map("users")
}

//  PAYCHECK (Core of Screen 1)  
model Paycheck {
  id            String    @id @default(auto()) @map("_id") @db.ObjectId
  userId        String    @db.ObjectId
  amount        Float
  month         Month
  year          Int
  paycheckDate  DateTime
  coverageStart DateTime
  coverageEnd   DateTime
  frequency     Frequency
  notes         String?

  totalBills      Float    @default(0)
  allowanceAmount Float    @default(0)
  savingsAmount   Float    @default(0)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Relations
  user             User              @relation(fields: [userId], references: [id])
  bills            Bill[]
  // savingsTrackers  SavingsTracker?
  allowanceTracker AllowanceTracker?

  @@unique([userId, coverageStart, coverageEnd])
  @@map("paychecks")
}

model Bill {
  id         String   @id @default(auto()) @map("_id") @db.ObjectId
  paycheckId String   @db.ObjectId
  name       String
  amount     Float
  dueDate    DateTime
  notes      String?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  paycheck Paycheck @relation(fields: [paycheckId], references: [id])

  @@map("bills")
}

// ALLOWANCE TRACKER (Screen 2)
model AllowanceTracker {
  id             String   @id @default(auto()) @map("_id") @db.ObjectId
  userId         String   @db.ObjectId
  paycheckId     String   @unique @db.ObjectId
  currentBalance Float    @default(0)
  clearedBalance Float    @default(0)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  user         User                   @relation(fields: [userId], references: [id])
  paycheck     Paycheck               @relation(fields: [paycheckId], references: [id])
  transactions AllowanceTransaction[]

  @@map("allowance_trackers")
}

model AllowanceTransaction {
  id          String          @id @default(auto()) @map("_id") @db.ObjectId
  allowanceId String          @db.ObjectId
  type        TransactionType
  amount      Float
  description String?
  category    String?
  payee       String?
  date        DateTime        @default(now())
  isCleared   Boolean         @default(false)
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt

  allowance AllowanceTracker @relation(fields: [allowanceId], references: [id])

  @@map("allowance_transactions")
}

// SAVINGS TRACKER (Screen 3)
model SavingsTracker {
  id         String @id @default(auto()) @map("_id") @db.ObjectId
  userId     String @db.ObjectId
  paycheckId String @unique @db.ObjectId

  currentBalance Float @default(0)
  clearedBalance Float @default(0)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // paycheck     Paycheck             @relation(fields: [paycheckId], references: [id])
  user         User                 @relation(fields: [userId], references: [id])
  transactions SavingsTransaction[]

  @@map("savings_trackers")
}

model SavingsTransaction {
  id        String @id @default(auto()) @map("_id") @db.ObjectId
  savingsId String @db.ObjectId

  type           TransactionType // CREDIT = saved money, DEBIT = withdrawal
  amount         Float
  currentBalance Float           @default(0)
  clearedBalance Float           @default(0)
  description    String?
  category       String?
  payee          String?
  date           DateTime        @default(now())
  isCleared      Boolean         @default(false)
  paycheckId     String?         @db.ObjectId
  savings        SavingsTracker  @relation(fields: [savingsId], references: [id])

  @@map("savings_transactions")
}

// CREDIT CARD TRACKER (Screen 4)
model CreditCardTracker {
  id     String @id @default(auto()) @map("_id") @db.ObjectId
  userId String @db.ObjectId
  user   User   @relation(fields: [userId], references: [id])

  cardName String

  currentBalance Float @default(0)
  clearedBalance Float @default(0)

  transactions CreditCardTransaction[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("credit_card_trackers")
}

// CREDIT CARD TRANSACTION/
model CreditCardTransaction {
  id           String            @id @default(auto()) @map("_id") @db.ObjectId
  creditCardId String            @db.ObjectId
  creditCard   CreditCardTracker @relation(fields: [creditCardId], references: [id])

  type        TransactionType
  amount      Float
  description String?
  category    String?
  payee       String?
  date        DateTime        @default(now())
  isCleared   Boolean         @default(false)
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt

  @@map("credit_card_transactions")
}

enum TransactionType {
  CREDIT
  DEBIT
}

model Otp {
  id        String    @id @default(auto()) @map("_id") @db.ObjectId
  email     String    @unique
  otp       Int
  expiry    DateTime?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  @@map("otps")
}

enum Frequency {
  WEEKLY
  BIWEEKLY
}

enum BillStatus {
  PENDING
  PAID
  OVERDUE
}

model SubscriptionUser {
  id                 String    @id @default(auto()) @map("_id") @db.ObjectId
  userId             String    @unique @db.ObjectId
  subscriptionId     String?
  subscriptionStart  DateTime?
  subscriptionEnd    DateTime?
  subscriptionStatus String? // e.g. "active", "canceled", "incomplete"
  cancelAtPeriodEnd  Boolean   @default(false)
  createdAt          DateTime  @default(now())
  updatedAt          DateTime  @updatedAt

  user User @relation(fields: [userId], references: [id])

  @@map("subscriptionUsers")
}

model Notifications {
  id         String   @id @default(auto()) @map("_id") @db.ObjectId
  receiverId String   @db.ObjectId
  senderId   String?  @db.ObjectId
  title      String
  body       String
  read       Boolean  @default(false)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  receiver   User     @relation("receiverDetails", fields: [receiverId], references: [id])
  sender     User?    @relation("senderDetails", fields: [senderId], references: [id])
}

enum Role {
  USER
  ADMIN
}

enum Status {
  PENDING
  ACTIVE
  BLOCKED
}

enum Month {
  JANUARY
  FEBRUARY
  MARCH
  APRIL
  MAY
  JUNE
  JULY
  AUGUST
  SEPTEMBER
  OCTOBER
  NOVEMBER
  DECEMBER
}
